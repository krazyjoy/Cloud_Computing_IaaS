
## IAM User Creation
Sign in  root user `huang gmail`, `Krazyjoy@56` 
$\rightarrow$ Home console
$\rightarrow$ search: `IAM Service`

Identity and Access Management (IAM) service
$\rightarrow$ Users
$\rightarrow$  Create User
- User details
	- User name:
	- Provide user access to the AWS Management console - true
		- I want to create an IAM user
		- Autogenerated password
		- Users must create a new password at next sign-in - true
- Set Permissions
	- Attach policies directly
	- Permissions policies: `AmazonEC2FullAccess`
$\rightarrow$  create user


### Development IAM
- Username: CSE546-Development
- Password:  LAtCL9'x
- Console sign-in url: https://191767066574.signin.aws.amazon.com/console
- Access Key: AKIASZJRVG7HNLD2E6IY
- Secret Access Key: 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
- Region: us-east-1

## Download AWS CLI
1. install aws cli
	- download for windows: [wscli.amazonaws.com/AWSCLIV2.msi](http://wscli.amazonaws.com/AWSCLIV2.msi)
	- check aws version: cmd $\rightarrow$ `aws --version`
2. configure aws cli
	- cmd $\rightarrow$ `aws configure`
	- configuration folder: `C:\Users\huang\.aws`
			create 2 files: `config` and `credentials`
## Creating EC2 Instance (Python)
- install boto3
- create a `credentials.py` contains access keys from IAM users and security_groups
- functions
	- create_key_pair: `ec2_key_pair`, latter moved to `C:\Users\huang\CSE546_SSH_KEYS`
	- authorize_security_inbound_rule: add security_group onto an instance, called in create_instance_and_store_id
	- create_instance_and_store_id:  launching an ec2 client with Developer IAM access key and secret access key, name the instance as `web-instance`
	- operate_on_instance: run created instance
## SSH Connection

- Location of SSH-KEYS for connecting to ec2 instance: `C:\Users\huang\CSE546_SSH_KEYS`
- Establish connection:
	`C:\Users\huang`  $\rightarrow$ 
	 
	 ```
	 ssh -i ./CSE546_SSH_KEYS/ec2_key_pair.pem ubuntu@ec2-3-87-67-173.compute-1.amazonaws.com
	 ```
- Resolve unable to `chmod 400 ec2_key_pair.pem` issue
	-  move pem file under C:/Users/ folder (e.g. `C:/Users/huang/CSE546_SSH_KEYS`)
	- change the security settings → disable inheritance → leave only the `owner's` authority
	  ![[ssh_key_pair_security_property.png]]

	- disable inheritance 
	![[disable_ssh_inheritance.png]]

## Activate Python Virtual Environment from Pycharm in another terminal

-  activate

```
source ./venv/Scripts/activate 
```

- deactivate
-```
```
deactivate
```

```
sudo apt install python3-pip
python3 --version
> Python 3.10.12
pip install Flask



```


 python ./web-tier/web_app.py

python workload_generator.py --num_request 3 --url 'http://127.0.0.1:5000' --image_folder '../dataset/face_images_1000/face_images_1000' --prediction_file '../dataset/face_images_1000/face_images_1000/classification_results_1000.csv'

## Setup EC2 Container to run Python program
- ssh connect to ec2

	```
	C:\Users\huang>
	ssh -i ./CSE546_SSH_KEYS/ec2_key_pair.pem ec2-user@ec2-18-210-115-175.compute-1.amazonaws.com
	```

SSH-EC2-connected.png
![[SSH-EC2-connected.png]]

- root access


	`sudo su 
	
	 root-access.png
	 
	![[root-access.png]]
	
- use yum
	`yum update`
	- install git
		`yum install git`
	- clone github repository
		`git clone https://github.com/krazyjoy/Cloud_Computing_IaaS.git`
- virtual environment (store at directory: `python3-virtualenv`)
	` python3 -m venv python3-virtualenv`
	- activate virtual environment
		`source python3-virtualenv/bin/activate`
- python3 install?
	`python3`
	`python3 --version`
	- install pip
		`yum install python3-pip`
	   - install packages command	
		`python3 -m pip + <package_name>`
	- install Flask
		`python3 -m pip install Flask`
	 - install Pandas
		 `python3 -m pip install pandas`
	- install requests
		 `python3 -m pip install requests`
	- install boto3
		`python3 -m pip install boto3`
		


	- run flask web app
	
	```
	(python3-virtualenv) [ec2-user@ip-172-31-47-197 Cloud_Computing_IaaS]$ python3 -m ./web-tier/web_app.py
	
	```
- test workloader

```
(python3-virtualenv) [root@ip-172-31-47-197 workload_generator]# python ./workload_generator.py --num_request 1000 --url 'http://18.210.115.175:5000' --image_folder "../dataset/face_images_1000" --prediction_file '../dataset/face_images_1000/classification_results_1000.csv'
```

- run test1 aws instance

```
(python3-virtualenv) [root@ip-172-31-47-197 Cloud_Computing_IaaS]$
python ./provided/scripts/project1_grader.py --access_keyId "AKIASZJRVG7HNLD2E6IY" --access_key "K7D9cfI0In3GQWhqruWT9Hxlb1LzNE3gfi6mYDQv"
```

![[test-aws-ec2-instance.png]]